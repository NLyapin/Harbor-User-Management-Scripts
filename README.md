# Harbor User Management Scripts

Этот набор скриптов помогает автоматизировать управление пользователями в Harbor: массовое создание пользователей из CSV и смену пароля (для себя или админом).

---

## 1\. `create_users_from_csv.py`

**Назначение:**  
Создает пользователей в Harbor из CSV-файла и (опционально) добавляет их в проекты с указанными ролями.

**CSV формат:**

-   Обязательные колонки: `Username`, `Password`, `Role`
    
-   Необязательная колонка: `Project`
    
-   В колонке `Project` можно указывать несколько проектов через запятую, например: `project1,project2`.
    

**Пример CSV:**

```csv
Username,Password,Role,Project
alice,Harbor12345,admin,project1,project2
bob,Harbor12345,developer,project1
carol,Harbor12345,guest,
```

**Запуск:**

```bash
python3 create_users_from_csv.py \
  --host https://example.com \
  --admin-user admin \
  --admin-pass 'SECRET' \
  --csv harbor_users.csv \
  --project project1,project2,project3 \
  --create-project-if-missing
```

**Флаги:**

-   `--host` — адрес Harbor.
    
-   `--admin-user` — пользователь с правами администратора.
    
-   `--admin-pass` — пароль администратора.
    
-   `--csv` — путь к CSV-файлу.
    
-   `--project` — дефолтный проект для всех пользователей (можно указать несколько через запятую).
    
-   `--create-project-if-missing` — если проекта не существует, создаёт его.
    

**Особенности:**

-   Поддержка нескольких проектов как через CSV, так и через флаг `--project`.
    
-   Роли из CSV (admin, developer, guest, maintainer и др.) сопоставляются с ID Harbor.
    
-   Если проект не найден и `--create-project-if-missing` не указан, выводится предупреждение.
    

---

## 2\. `change_password.py`

**Назначение:**  
Интерактивная смена пароля в Harbor.

-   Пользователь может сменить свой пароль.
    
-   Админ может сменить пароль другого пользователя.
    

**Пример: смена собственного пароля**

```bash
python3 change_password.py --host http://localhost --user alice --prompt-pass
```

**Процесс:**

1.  Скрипт запрашивает пароль действующего пользователя (`Password for acting user:`).
    
2.  Если это сам пользователь, запрашивает:
    
    -   текущий пароль (`Current password:`)
        
    -   новый пароль (`New password:`)
        
    -   подтверждение нового пароля (`Confirm new password:`)
        
3.  Пароль проверяется на требования Harbor:
    
    -   8–128 символов
        
    -   хотя бы одна заглавная и одна строчная буква
        
    -   хотя бы одна цифра
        

**Пример: админ меняет пароль другого пользователя**

```bash
python3 change_password.py \
  --host http://localhost \
  --user admin \
  --prompt-pass \
  --target bob
```

**Процесс:**

1.  Скрипт запрашивает пароль администратора.
    
2.  Затем новый пароль для целевого пользователя (`New password for bob:`) и подтверждение.
    
3.  Пароль обновляется через API Harbor.
    

**Флаги:**

-   `--host` — адрес Harbor.
    
-   `--user` — действующий пользователь (админ или обычный).
    
-   `--prompt-pass` — запрашивать пароль действующего пользователя.
    
-   `--target` — имя пользователя, чей пароль меняем (только для админа).
    

**Особенности:**

-   Скрипт аккуратно обрабатывает ошибки: неправильный пароль, несоответствие требованиям к сложности, пользователь не найден и др.
    
-   Поддерживает Harbor API v2.0.